<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submit Project - CODENET</title>
  <link rel="stylesheet" href="codenet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet" />
  <!-- API Client -->
  <script src="api.js"></script>
</head>
<body>

<header class="top-menu">
    <ul>
      <li><img src="C.webp" alt="brand logo" class="logo" /></li>
      <li><a href="codenet.html" class="nav-link">HOME</a></li>
      <li><a href="codelibrary.html" class="nav-link">CODE LIBRARY</a></li>
      <li><a href="submitproject.html" class="nav-link">SUBMIT PROJECT</a></li>
      <li><a href ="aboutus.html" class="nav-link">ABOUT US</a></li>
    </ul>
    <div class="header-right">
      <div id="auth-status">
        <a href="login.html" class="auth-btn">LOGIN / SIGN UP</a>
      </div>
      <a href="mailto:binupanuransith@gmail.com" class="contact">CONTACT US</a>
    </div>
    <div class="hamburger" onclick="toggleMenu()">&#9776;</div>
  </header>

  
    <section class="middle-log">
    <div class="content-log">
        <form class="submit-form" enctype="multipart/form-data">
          <h2>Submit Your Project</h2>
          
          <label for="title">Project Title *</label>
          <input type="text" id="title" name="title" required />

          <label for="subtitle">Subtitle (Optional)</label>
          <input type="text" id="subtitle" name="subtitle" />

          <label for="description">Brief Description *</label>
          <textarea id="description" name="description" rows="4" required maxlength="5000" placeholder="Describe your project (1-5000 characters)"></textarea>
          <small id="char-count">0/5000 characters</small>

          <label for="media">Upload Photos/Videos</label>
          <input type="file" id="media" name="media" accept="image/*,video/*" multiple />
          <small>Please upload clear, relevant photos/videos that describe your project</small>

          <div id="file-preview"></div>

          <input type="submit" value="Submit Project" id="submit-btn" />
          <div id="submission-status"></div>
        </form>
    </div>
  </section>



    <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-left">
      <ul>
        <li>
          <img src="C.webp" alt="logo" style="height: 50px; width: 150px;" />
        </li>
        <li>
          <img src="download.png" alt="Facebook" style="height: 50px; width: 50px; border-radius: 100%;" />
            <img src="download (1).png" alt="Instagram" style="height: 50px; width: 50px; border-radius: 100%;" />
          </a>
        </li>
      </ul>
    </div>
    <div class="footer-right">
      <ul>
        <li>
          <img src="images (1).png" alt="telephone" style="height: 30px; width: 30px; padding-right: 20px; padding-top: 10px;" />
          <p>+94-77-483-7197</p>
        </li>
        <li>
          <img src="images.png" alt="mail" style="height: 30px; width: 30px; padding-right: 20px; padding-top: 10px;" />
          <p><a href="mailto:binupanuransith@gmail.com"> binupanuransith@gmail.com</a></p>
        </li>
      </ul>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2025 CODENET</p>
    </div>
  </footer>

  <script>
    // Initialize page without authentication for now
    window.addEventListener('load', function() {
      console.log('Submit project page loaded');
      setupFormHandlers();
    });

    // Mock authentication status for development
    function updateAuthStatus() {
      const authStatus = document.getElementById('auth-status');
      // For development, show login link
      authStatus.innerHTML = '<a href="login.html" class="auth-btn">LOGIN / SIGN UP</a>';
    }

    // Mock authentication check for development
    function checkAuthentication() {
      // For development, allow all users to submit projects
      console.log('Authentication check: Development mode - allowing all submissions');
      return true;
    }

    // Mock logout function
    function logout() {
      console.log('Logout clicked - development mode');
      alert('Logout functionality will be implemented with authentication');
    }

    // Setup form handlers
    function setupFormHandlers() {
      // Character counter for description
      const descriptionField = document.getElementById('description');
      if (descriptionField) {
        descriptionField.addEventListener('input', function() {
          const maxLength = 5000;
          const currentLength = this.value.length;
          const counter = document.getElementById('char-count');
          if (counter) {
            counter.textContent = `${currentLength}/${maxLength} characters`;
            
            if (currentLength > maxLength * 0.9) {
              counter.style.color = '#ff6b6b';
            } else {
              counter.style.color = '#666';
            }
          }
        });
      }

      // File preview functionality
      const mediaField = document.getElementById('media');
      if (mediaField) {
        mediaField.addEventListener('change', function() {
          const preview = document.getElementById('file-preview');
          if (preview) {
            preview.innerHTML = '';
            
            if (this.files.length > 0) {
              const fileList = document.createElement('div');
              fileList.innerHTML = '<h4>Selected Files:</h4>';
              
              Array.from(this.files).forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.style.margin = '5px 0';
                fileItem.innerHTML = `üìÅ ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                fileList.appendChild(fileItem);
              });
              
              preview.appendChild(fileList);
            }
          }
        });
      }

      // Form submission handler
      const submitForm = document.querySelector('.submit-form');
      if (submitForm) {
        submitForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          console.log('Form submitted - development mode');
          alert('Project submission feature will be connected when backend is ready');
        });
      }
    }
      const statusDiv = document.getElementById('submission-status');
      
      // Clear previous errors
      clearFormErrors();
      
      try {
        // Check authentication
        const authToken = await api.getAuthToken();
        if (!authToken) {
          api.showError('Please log in to submit a project.');
          setTimeout(() => window.location.href = 'login.html', 2000);
          return;
        }

        // Show loading state
        submitBtn.disabled = true;
        submitBtn.classList.add('btn-loading');
        submitBtn.value = 'Submitting...';
        statusDiv.innerHTML = `
          <div class="loading-spinner">
            <div class="spinner"></div>
            <span>Submitting your project...</span>
          </div>
        `;

        // Get form data
        const title = document.getElementById('title').value.trim();
        const subtitle = document.getElementById('subtitle').value.trim();
        const description = document.getElementById('description').value.trim();
        const mediaFiles = document.getElementById('media').files;

        // Validate form data
        const errors = validateForm(title, subtitle, description, mediaFiles);
        if (errors.length > 0) {
          showFormErrors(errors);
          throw new Error(errors[0].message);
        }

        // Create project data
        const projectData = {
          title: title,
          subtitle: subtitle || null,
          description: description
        };

        // Submit project using API client
        const result = await api.createProject(projectData, Array.from(mediaFiles));

        // Success
        api.showSuccess('Project submitted successfully! It will be reviewed by our team.');
        statusDiv.innerHTML = `
          <div class="success-message">
            <span class="success-icon">‚úÖ</span>
            <span>Project submitted successfully!</span>
            <small>Your project will be reviewed by our team.</small>
          </div>
        `;
        
        // Reset form after success
        setTimeout(() => {
          this.reset();
          document.getElementById('file-preview').innerHTML = '';
          document.getElementById('char-count').textContent = '0/5000 characters';
          statusDiv.innerHTML = '';
          
          // Ask if user wants to view their projects
          if (confirm('Project submitted! Would you like to view your projects?')) {
            window.location.href = 'userprofile.html';
          }
        }, 2000);

      } catch (error) {
        console.error('Error submitting project:', error);
        
        let errorMessage = 'An error occurred while submitting the project.';
        
        if (error.message.includes('401')) {
          errorMessage = 'Authentication failed. Please log in again.';
          setTimeout(() => window.location.href = 'login.html', 2000);
        } else if (error.message.includes('413') || error.message.includes('too large')) {
          errorMessage = 'Files are too large. Please choose smaller files.';
        } else if (error.message.includes('400')) {
          errorMessage = 'Invalid data provided. Please check your inputs.';
        } else if (error.message.includes('500')) {
          errorMessage = 'Server error. Please try again later.';
        } else if (error.message) {
          errorMessage = error.message;
        }
        
        statusDiv.innerHTML = `
          <div class="error-message">
            <span class="error-icon">‚ùå</span>
            <span>${errorMessage}</span>
            <button onclick="this.parentElement.parentElement.innerHTML = ''" class="retry-btn">Clear</button>
          </div>
        `;
        
        api.showError(errorMessage);
        
      } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.classList.remove('btn-loading');
        submitBtn.value = 'Submit Project';
      }
    });

    // Form validation function
    function validateForm(title, subtitle, description, mediaFiles) {
      const errors = [];

      if (!title) {
        errors.push({ field: 'title', message: 'Project title is required.' });
      } else if (title.length > 100) {
        errors.push({ field: 'title', message: 'Title must be 100 characters or less.' });
      }

      if (subtitle && subtitle.length > 200) {
        errors.push({ field: 'subtitle', message: 'Subtitle must be 200 characters or less.' });
      }

      if (!description) {
        errors.push({ field: 'description', message: 'Project description is required.' });
      } else if (description.length < 50) {
        errors.push({ field: 'description', message: 'Description must be at least 50 characters.' });
      } else if (description.length > 5000) {
        errors.push({ field: 'description', message: 'Description must be 5000 characters or less.' });
      }

      if (mediaFiles.length > 10) {
        errors.push({ field: 'media', message: 'Maximum 10 files allowed.' });
      }

      // Check file sizes
      for (let file of mediaFiles) {
        if (file.size > 10 * 1024 * 1024) { // 10MB limit
          errors.push({ field: 'media', message: `File "${file.name}" is too large. Maximum size is 10MB.` });
        }
      }

      return errors;
    }

    // Show form errors
    function showFormErrors(errors) {
      errors.forEach(error => {
        const field = document.getElementById(error.field);
        if (field) {
          field.classList.add('input-error');
          
          // Remove existing error message
          const existingError = field.parentElement.querySelector('.form-error');
          if (existingError) {
            existingError.remove();
          }
          
          // Add new error message
          const errorElement = document.createElement('span');
          errorElement.className = 'form-error';
          errorElement.textContent = error.message;
          field.parentElement.appendChild(errorElement);
        }
      });
    }

    // Clear form errors
    function clearFormErrors() {
      document.querySelectorAll('.input-error').forEach(field => {
        field.classList.remove('input-error');
      });
      
      document.querySelectorAll('.form-error').forEach(error => {
        error.remove();
      });
    }

    // Add input event listeners for real-time validation
    document.addEventListener('DOMContentLoaded', function() {
      const titleField = document.getElementById('title');
      const subtitleField = document.getElementById('subtitle');
      const descriptionField = document.getElementById('description');
      const mediaField = document.getElementById('media');

      // Clear errors on input
      [titleField, subtitleField, descriptionField, mediaField].forEach(field => {
        if (field) {
          field.addEventListener('input', function() {
            this.classList.remove('input-error');
            const errorElement = this.parentElement.querySelector('.form-error');
            if (errorElement) {
              errorElement.remove();
            }
          });
        }
      });
    });
  </script>

</body>
</html>
